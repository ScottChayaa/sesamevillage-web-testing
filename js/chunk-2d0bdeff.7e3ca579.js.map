{"version":3,"sources":["webpack:///./src/views/ap/teacher/login/PasswordReset.vue?1d9a","webpack:///./src/controllers/ap/teacher/login/PasswordReset.ts","webpack:///./src/views/ap/teacher/login/PasswordReset.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","_m","_v","directives","name","rawName","value","loginForm","expression","domProps","on","$event","target","composing","$set","errorMsgMap","_s","_e","doubleClick","preventDefault","validateAndSubmit","lightbox","errorMsg","showLB","confirmLink","closeLB","staticRenderFns","newPwd","confirmPwd","verification","IsDefined","IsNotEmpty","message","Matches","verificationCode","uid","imgSrc","created","refreshVerificationCode","getCookie","timestamp","Math","floor","Date","now","toString","random","codeItem","uniqueID","refreshCodeImg","skipMissingProperties","then","result","length","forEach","item","index","error","constraints","Object","keys","key","property","code","acc","$route","query","pwd","teResetPwd","errNo","UserResetPwdSuccess","UserResetPwdInvalid","ApTeacherLoginPasswordResetController","components","APLightbox","component"],"mappings":"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","file":"js/chunk-2d0bdeff.7e3ca579.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('div',{staticClass:\"login-page\"},[_c('div',{staticClass:\"login-box\"},[_c('div',{staticClass:\"box\"}),_c('form',{attrs:{\"method\":\"post\",\"name\":\"login\",\"id\":\"login\"}},[_vm._m(0),_vm._m(1),_c('div',{staticClass:\"l-login\"},[_c('div',{staticClass:\"logo\"}),_c('h1',[_vm._v(\"重設密碼\")]),_c('div',{staticClass:\"input-box\"},[_c('i',{staticClass:\"fa fa-lock\"}),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.loginForm.newPwd),expression:\"loginForm.newPwd\"}],staticClass:\"input-sty\",attrs:{\"type\":\"password\",\"name\":\"newPwd\",\"id\":\"newPwd\",\"placeholder\":\"請輸入新密碼\",\"autocomplete\":\"off\"},domProps:{\"value\":(_vm.loginForm.newPwd)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.$set(_vm.loginForm, \"newPwd\", $event.target.value)}}}),(_vm.errorMsgMap['newPwd'] !== '')?_c('label',{staticClass:\"error\"},[_vm._v(_vm._s(_vm.errorMsgMap['newPwd']))]):_vm._e()]),_c('div',{staticClass:\"input-box\"},[_c('i',{staticClass:\"fa fa-lock\"}),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.loginForm.confirmPwd),expression:\"loginForm.confirmPwd\"}],staticClass:\"input-sty\",attrs:{\"type\":\"password\",\"name\":\"confirmPwd\",\"id\":\"confirmPwd\",\"placeholder\":\"請再次輸入新密碼\",\"autocomplete\":\"off\"},domProps:{\"value\":(_vm.loginForm.confirmPwd)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.$set(_vm.loginForm, \"confirmPwd\", $event.target.value)}}}),(_vm.errorMsgMap['confirmPwd'] !== '')?_c('label',{staticClass:\"error\"},[_vm._v(_vm._s(_vm.errorMsgMap['confirmPwd']))]):_vm._e()]),_c('div',{staticClass:\"l-login-btn-box\"},[_c('a',{staticClass:\"btn login-submit-btn\",attrs:{\"disabled\":_vm.doubleClick},on:{\"click\":function($event){$event.preventDefault();return _vm.validateAndSubmit()}}},[_vm._v(\"送出\")])]),_c('div',{staticClass:\"l-login-footer\"},[_vm._v(\" ©2021 芝蔴街e學園 \")]),_vm._m(2)])])])]),_c('APLightbox',{attrs:{\"message\":_vm.lightbox.errorMsg,\"showLB\":_vm.lightbox.showLB,\"confirmLink\":_vm.lightbox.confirmLink},on:{\"closeAPLightbox\":_vm.closeLB}})],1)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"login_dec02\"},[_c('img',{attrs:{\"src\":require(\"@/img/login_dec02.png\")}})])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"login_dec03\"},[_c('img',{attrs:{\"src\":require(\"@/img/login_dec03.png\")}})])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"dec login_dec01\"},[_c('img',{attrs:{\"src\":require(\"@/img/login_dec01.png\")}})])}]\n\nexport { render, staticRenderFns }","import { Component, Vue } from \"vue-property-decorator\";\nimport { IsDefined, IsNotEmpty, Matches, validate } from \"class-validator\";\n\nimport { ErrorCode, ErrorMessage } from \"@/constant\";\nimport { AccountModel } from \"@/models\";\nimport { APLightbox } from \"@/components\";\nimport { Cookie } from \"@/util\";\n\nexport class LoginForm {\n    @IsDefined() @IsNotEmpty({ message: \"*必填\" }) @Matches(/^(?=.*[a-z])(?=.*[A-Z])[A-Za-z].{6,}$/, { message: '*請輸入至少6位包含大小寫英文字母的密碼'}) newPwd = '';\n    @IsDefined() @IsNotEmpty({ message: \"*必填\" }) confirmPwd = '';\n    @IsDefined() verification = '';\n}\n\n@Component<ApTeacherLoginPasswordResetController>({\n    components: {\n        APLightbox\n    }\n})\nexport default class ApTeacherLoginPasswordResetController extends Vue {\n    private doubleClick = false;\n    private loginForm = new LoginForm();\n    private verificationCode: { [key: string]: string } = {\n        uid: \"\",\n        imgSrc: \"\"\n    };\n    private errorMsgMap: { [key: string]: string } = {\n        newPwd: '',\n        confirmPwd: '',\n        verification: '',\n    };\n    private lightbox: { showLB: boolean, errorMsg: string, confirmLink: string } = {\n        showLB: false, \n        errorMsg:  '',\n        confirmLink: '',\n    };\n\n    public created() {\n        this.refreshVerificationCode(); //取得驗證碼圖片\n\n        //驗證連結\n        if (Cookie.getCookie('resetPwd') === null) {\n            this.lightbox.errorMsg = '連結已失效';\n            this.lightbox.showLB = true;\n            this.lightbox.confirmLink = '/teacher/login';\n        };\n    }\n    \n    private async refreshVerificationCode() {\n        if (!this.doubleClick) {\n            this.doubleClick = true;\n\n            const timestamp = Math.floor(Date.now() / 1000).toString();\n            const random = Math.floor(Math.random() * 1000).toString();\n            this.verificationCode.uid = timestamp + random;\n\n            const codeItem = {\n                uniqueID: this.verificationCode.uid\n            };\n            this.verificationCode.imgSrc = await AccountModel.refreshCodeImg(codeItem); //通過model call api回傳所需資料\n            this.doubleClick = false;\n        }\n    }\n\n    private async validateAndSubmit() {\n        validate(this.loginForm, { skipMissingProperties: true }).then(\n            async result => {\n                this.errorMsgMap = { //先清空error message\n                    newPwd: '',\n                    confirmPwd: '',\n                    verification: '',\n                };\n\n                if (result.length !== 0) {\n                    result.forEach((item, index) => {\n                        const error = item.constraints as {\n                            [key: string]: string;\n                        };\n                        Object.keys(error).forEach(key => {\n                            this.errorMsgMap[item.property] = error[key]; //放入error message\n                        });\n                    });\n                    return;\n                }\n\n                if(this.loginForm.confirmPwd != this.loginForm.newPwd){\n                    this.errorMsgMap['confirmPwd'] = '*再次輸入密碼不符';\n                    return;\n                }\n\n                if (!this.doubleClick) {\n                    this.doubleClick = true;\n\n                    const codeItem = {\n                        code: this.loginForm.verification,\n                        uniqueID: this.verificationCode.uid\n                    };\n\n                    // const verificationCodeErrNo = await AccountModel.verificationCodeCheck(codeItem); //呼叫api 驗證驗證碼正確性\n\n                    // if (verificationCodeErrNo !== ErrorCode.Success) {\n                    //     this.errorMsgMap['verification'] = ErrorMessage[verificationCodeErrNo];\n                    //     this.doubleClick = false;\n                    //     this.refreshVerificationCode();\n                    //     return;\n                    // }\n\n                    const item = {\n                        acc: this.$route.query.acc,\n                        pwd: this.loginForm.newPwd,\n                    };\n                    const errNo = await AccountModel.teResetPwd(item);\n                    this.lightbox.errorMsg = ErrorMessage[errNo];\n                    this.lightbox.showLB = true;\n                    if (errNo === ErrorCode.UserResetPwdSuccess || errNo === ErrorCode.UserResetPwdInvalid) {\n                        this.lightbox.confirmLink = '/teacher/login';\n                    } else {\n                        this.refreshVerificationCode();\n                    }\n                    this.doubleClick = false;\n                }\n            }\n        );\n    }\n\n    private closeLB() {\n        this.lightbox.showLB = false;\n    }\n}","import { render, staticRenderFns } from \"./PasswordReset.vue?vue&type=template&id=b7a6b8a0&\"\nimport script from \"@/controllers/ap/teacher/login/PasswordReset?v=2.0?vue&type=script&lang=ts&\"\nexport * from \"@/controllers/ap/teacher/login/PasswordReset?v=2.0?vue&type=script&lang=ts&\"\nimport style0 from \"@/assets/css/main.css?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}